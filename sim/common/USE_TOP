# Common makefile definitions for simulation.

include $(PROJECT_TOP)/Makefile.common

# Command to run vivado
RUN_VIVADO = source $(VIVADO) && vivado

VPATH += $(PYTHONDIR)

VHDDIR = $(PROJECT_TOP)/AMC/vhd

RUN_VSIM = VHD_DIR=$(VHDDIR) BENCH_DIR=$(SIMDIR)/bench MTI_VCO_MODE=64 $(VSIM)

BUILT += $(notdir $(wildcard $(SIMDIR)/do/*.do))
BUILT += modelsim.ini

default: vsim
.PHONY: default

built: $(BUILT)
.PHONY: built

vsim: $(BUILT)
	$(DO_RUN_VSIM)
.PHONY: vsim

print-simdir:
	@printf %s '$(CURDIR)'
.PHONY: print-simdir


%.vhd: %.py %.in
	$(PYTHON) $^ >$@

%.do: $(SIMDIR)/do/%.do
	ln -sf $< $@

modelsim.ini: $(COMMON_DIR)/modelsim.ini
	sed 's:@@MODELSIM_LIBS@@:$(MODELSIM_LIBS):' $< >$@


# Default action for vsim target, can be overridden
define DO_RUN_VSIM
$(RUN_VSIM)
endef


.DELETE_ON_ERROR:

# vim: set filetype=make:
